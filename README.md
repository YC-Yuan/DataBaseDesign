# DataBaseDesign

19302010020 袁逸聪

Lab使用mysql与python3.9

- mysql  Ver 14.14 Distrib 5.7.33, for Win64 (x86_64)

## 表模型分析

为了尽可能降低数据库的耦合性，提高复用空间，应先考虑所提供的数据中有哪些可抽象的实体概念，而不是完全根据数据内容创建表。

1. 考点：考点应是独立的实体，具有考点号、考点名称两个字段
2. 学生：学生应是独立的实体，具有考号、姓名字段
3. 考试：在某个考场举行的考试，引用考点的考点号、考点名称字段，本身具有考场号、场次号、开考时间、指定试卷号
4. 准考证：某学生参与某场考试，引用考试的考点号、考场号、场次号（间接地引用了考点）字段，引用学生的考号、姓名字段，本身指定座位号

从引用关系的角度分析，考试基于考点，准考证基于考试和学生

从实体-关系的角度分析，则还需要补充：

1. 考点、考试、学生为实体，准考证表示的学生与考试之间的参与关系，用联系集表示
2. 考点和考试之间也存在“安排于”的关系，应当设置联系集
3. 考试实体集是一个弱实体集，因为去除了冗余的考点编号属性后，其余属性不足以表示元组了

![E-R关系图](E-R.png)

- 使用的画图工具Process On无法绘制双线，顾使用点线代替弱实体集与弱联系集的连接符

## 关系模式

注：命名沿用了数据表中英文与拼音混合的方式

实体集

- kd(<u>kdno</u>,kd_name)
- exam(<u>kdno</u>,<u>kcno</u>,<u>ccno</u>,exptime,papername)
- student(<u>registno</u>,stu_name)

联系集
- exam_takes(<u>registno</u>,seat,stu_no,<u>kdno</u>,<u>kcno</u>,<u>ccno</u>)
- exam_arrangement(<u>kdno</u>,<u>kcno</u>,<u>ccno</u>,exptime,papername)

对于弱实体集exam，其对应的弱联系集关系模式与其自身完全一致。此处处理方式参考书本P182与P183对于section与sec_course的分析,仍将二者都写出。

但此时的弱联系集（exam_arrangement、sec_course）是实现上的冗余，故在Lab实现中省略。(参照11.8号课上讲法)

## 字段类型

| 字段名称  | 字段类型      |
| --------- | ------------- |
| kdno      | numeric(4,0)  |
| kd_name   | varchar(20)   |
| kcno      | numeric(4,0)  |
| ccno      | numeric(4,0)  |
| exptime   |               |
| papername | varchar(20)   |
| stu_no    | numeric(11,0) |
| stu_name  | varchar(20)   |
| registno  | numeric(6,0)  |
| seat      | numeric(3,0)  |

## 使用说明

配置文件configs.txt中依次记录了mysql主机、用户名、密码、mysql中的数据库名

默认如下，请根据需要修改

```txt
localhost
root
password
database_lab1
```

main.py为程序入口，请在命令行调用

程序接受两个参数，第一个参数表示载入数据类型，第二个参数表示数据表文件地址，形如下（开发中注意到给出的csv数据采用了不同编码，不过程序可以自动识别编码，故无须用户指定）

> python main.py room room.csv

对于错误的参数使用，程序会自动停机并给出提示

由于准考证表引用了考试表的内容，对于一套数据，请先载入room再载入student

对于致命错误，程序将停机并全表回滚:

1. 参数无法识别
2. 找不到参数给出的数据表
3. 数据表表头不符合要求
4. 数据内容格式错误
5. 数据信息前后冲突(如同一个考点号对应的多个考点名称或一个准考证号对应多位同学)
6. 要插入的准考信息找不到对应考场
7. 数据库层发生错误

对于可接受的特殊情况，程序将执行完毕并给出提示：

1. papername未指定
2. seat未指定
3. 准考信息重复(即出现多条某同学在同一场次进行考试的记录)
